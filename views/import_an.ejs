<!DOCTYPE html>
<html>
<head>
  <title>PO ê²°ì œ ê´€ë¦¬</title>
  <style>
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 14px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f4f4f4; }
    .paid { background-color: #e0ffe0; }
    .unpaid { background-color: #ffe0e0; }
    .form-section { margin-top: 30px; padding: 15px; border: 1px solid #aaa; border-radius: 6px; }
  </style>
</head>
<body>
  <h2>ğŸ“‹ PO ê²°ì œ ê´€ë¦¬</h2>

  <!-- âœ… í•„í„° -->
  <form method="GET" action="/import_an">
    <label>
      <input type="checkbox" name="filter" value="unpaid" <% if (filter === 'unpaid') { %>checked<% } %> >
      ì”ê¸ˆ ë‚¨ì€ POë§Œ ë³´ê¸°
    </label>
    <label>
      <input type="checkbox" name="filter" value="paid" <% if (filter === 'paid') { %>checked<% } %> >
      ê²°ì œ ì™„ë£Œëœ POë§Œ ë³´ê¸°
    </label>
    <button type="submit">í•„í„° ì ìš©</button>
  </form>

  <!-- âœ… PO ëª©ë¡ -->
  <table>
    <thead>
      <tr>
        <th>ë‚ ì§œ</th>
        <th>PO ë²ˆí˜¸</th>
        <th>Style</th>
        <th>ìˆ˜ëŸ‰</th>
        <th>ë‹¨ê°€</th>
        <th>ì´ì•¡</th>
        <th>ì”ê¸ˆ</th>
        <th>ë¹„ê³ </th>
        <th>ì„ ìˆ˜ê¸ˆ</th>
        <th>ì”ê¸ˆ ê²°ì œ</th>
        <th>ê²°ì œ ê¸°ë¡</th>
      </tr>
    </thead>
    <tbody>
      <% poList.forEach(po => { %>
        <tr class="<%= po.remain === 0 ? 'paid' : 'unpaid' %>">
          <td><%= po.podate %></td>
          <td><%= po.pono %></td>
          <td><%= po.style %></td>
          <td><%= po.pcs %></td>
          <td><%= po.price %></td>
          <td><%= po.poamount %></td>
          <td><%= po.remain %></td>
          <td><%= po.note || '-' %></td>
          <td>
            <% if (po.remain > 0 && po.poamount * 0.3 <= po.remain) { %>
              <form method="POST" action="/popayment/deposit">
                <input type="hidden" name="po_id" value="<%= po.id %>">
                <input type="hidden" name="amount" value="<%= (po.poamount * 0.3).toFixed(2) %>">
                <button type="submit">30% ê²°ì œ</button>
              </form>
            <% } else { %>ì™„ë£Œ<% } %>
          </td>
          <td>
            <% if (po.remain > 0 && po.poamount * 0.3 > po.remain) { %>
              <form method="POST" action="/popayment/final">
                <input type="hidden" name="po_id" value="<%= po.id %>">
                <input type="number" name="pcs" value="<%= po.pcs %>" placeholder="ìˆ˜ì • ìˆ˜ëŸ‰" required>
                <input type="number" name="price" value="<%= po.price %>" placeholder="ìˆ˜ì • ë‹¨ê°€" step="0.01" required>
                <button type="submit">ì”ê¸ˆ ê²°ì œ</button>
              </form>
            <% } else { %>-<% } %>
          </td>
          <td>
            <form method="GET" action="/popayment/history/<%= po.id %>">
              <button type="submit">ğŸ”</button>
            </form>
          </td>
        </tr>
      <% }); %>
    </tbody>
  </table>

  <!-- âœ… ê²°ì œ ì¼ì ë° í™˜ìœ¨ ì…ë ¥ ì˜ì—­ -->
  <div class="form-section">
    <h4>ê²°ì œ ì •ë³´ ì…ë ¥</h4>
    <form method="POST" action="/popayment/setPayInfo">
      <label>ê²°ì œì¼: <input type="date" name="paydate" required></label>
      <label>í™˜ìœ¨(USD â†’ KRW): <input type="number" name="exrate" step="0.0001" required></label>
      <button type="submit">ì…ë ¥ ì ìš©</button>
    </form>
  </div>
</body>
</html>
